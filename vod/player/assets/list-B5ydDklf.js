import{p as e,ae as a,s as l,ac as t,ay as i,C as s,H as n,az as o,d,m as u,t as m,O as r,R as c,o as p,c as V,w as f,W as v,b,f as x,aa as y,P as k,e as j,ao as g}from"./index-2SkDt_TU.js";import{V as h,c as w,a as C,b as _}from"./VCard-BAwN_RQS.js";import{V as U}from"./VIcon-DWjsSruu.js";import{V as O}from"./VSpacer-hV2MslHp.js";import{V as S}from"./VBtn-fYrJ95-_.js";import{V as F}from"./VTextField-7aAJCujH.js";import{V as T}from"./VDivider-C1bqgPYi.js";import{m as z,V as D,a as I}from"./VDataTable-BYFRDRX2.js";import{V as G}from"./VForm-D_SB7bOs.js";import{V as P}from"./VTextarea-prSPU7-4.js";import{m as A,u as B,V as J}from"./VInput-BGypikvD.js";import{V as N}from"./VDialog-Du2IKJGo.js";import"./VAvatar-N9S0wcjS.js";import"./elevation-DyP75-Bh.js";import"./loader-B-9DN2BB.js";/* empty css              */import"./VMenu-CYLIQlau.js";import"./index-Dt7l_SBc.js";import"./VSlideGroup-DmflEvdz.js";const R=e({...A(),...a(z(),["inline"])},"VCheckbox"),$=l()({name:"VCheckbox",inheritAttrs:!1,props:R(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,a){let{attrs:l,slots:m}=a;const r=t(e,"modelValue"),{isFocused:c,focus:p,blur:V}=B(e),f=i(),v=s((()=>e.id||"checkbox-"+f));return n((()=>{const[a,t]=o(l),i=J.filterProps(e),s=D.filterProps(e);return d(J,u({class:["v-checkbox",e.class]},a,i,{modelValue:r.value,"onUpdate:modelValue":e=>r.value=e,id:v.value,focused:c.value,style:e.style}),{...m,default:e=>{let{id:a,messagesId:l,isDisabled:i,isReadonly:n,isValid:o}=e;return d(D,u(s,{id:a.value,"aria-describedby":l.value,disabled:i.value,readonly:n.value},t,{error:!1===o.value,modelValue:r.value,"onUpdate:modelValue":e=>r.value=e,onFocus:p,onBlur:V}),m)}})})),{}}}),q={__name:"list",setup(e){const a=m(""),l=m(!1),t=[{title:"用户名",key:"username"},{title:"密码",key:"password"},{title:"Token",key:"token"},{title:"管理",key:"admin"},{title:"操作",key:"actions",sortable:!1}],i=v("axios"),n=r([]),o=r({index:-1,item:{}}),u={username:[e=>!!e||"账号不能为空"],password:[e=>!!e||"密码不能为空"]},z=m(!1);c(z,(e=>{e||g((()=>{Object.assign(o,{index:-1,item:{}})}))}));const A=m(!1);c(A,(e=>{e||g((()=>{Object.assign(o,{index:-1,item:{}})}))}));const B=s({get:()=>JSON.stringify(o.item.lives||[],null,2),set(e){o.item.lives=JSON.parse(e)}}),J=async()=>{l.value=!0;try{await i.delete("/user/"+o.item.username),n.splice(o.editedIndex,1),A.value=!1}finally{l.value=!1}},R=async e=>{if(!(await e).valid)return!1;l.value=!0;try{if(o.index>-1){const e=await i.put("/user",o.item);Object.assign(n[o.index],e)}else{const e=await i.post("/user",o.item);n.push(e)}z.value=!1}finally{l.value=!1}},q=async()=>{l.value=!0;try{const e=await i.get("/user/list");n.length>0&&n.splice(0,n.length),n.push(...e)}finally{l.value=!1}};return p(q),(e,i)=>(b(),V(h,{flat:""},{default:f((()=>[d(w,{class:"d-flex align-center pe-2"},{default:f((()=>[d(U,{icon:"mdi-account-multiple"}),d(O),d(S,{icon:"mdi-refresh",density:"comfortable",variant:"text",class:"mr-2",onClick:q}),d(S,{icon:"mdi-account-plus",density:"comfortable",variant:"text",class:"mr-2",onClick:i[0]||(i[0]=e=>z.value=!0)}),d(F,{modelValue:x(a),"onUpdate:modelValue":i[1]||(i[1]=e=>y(a)?a.value=e:null),density:"compact",label:"Search","prepend-inner-icon":"mdi-magnify",variant:"solo-filled",flat:"","hide-details":"","single-line":""},null,8,["modelValue"])])),_:1}),d(T),d(I,{headers:t,items:x(n),loading:x(l),search:x(a),"item-key":"username","hide-default-footer":""},{"item.admin":f((({item:e})=>[d(D,{modelValue:e.admin,"onUpdate:modelValue":a=>e.admin=a,readonly:""},null,8,["modelValue","onUpdate:modelValue"])])),"item.actions":f((({item:e})=>[d(S,{icon:"mdi-pencil",density:"comfortable",class:"mr-2",size:"small",variant:"text",onClick:a=>(e=>{o.index=n.indexOf(e),o.item=Object.assign({},e),z.value=!0})(e)},null,8,["onClick"]),d(S,{icon:"mdi-delete",density:"comfortable",class:"mr-2",size:"small",variant:"text",onClick:a=>(e=>{o.index=n.indexOf(e),o.item=Object.assign({},e),A.value=!0})(e)},null,8,["onClick"])])),_:1},8,["items","loading","search"]),d(N,{modelValue:x(z),"onUpdate:modelValue":i[8]||(i[8]=e=>y(z)?z.value=e:null),"max-width":"500px"},{default:f((()=>{var e;return[d(h,{disabled:x(l),loading:x(l),"prepend-icon":"mdi-account",title:(null==(e=x(o).item)?void 0:e.username)?`修改[${x(o).item.username}]`:"添加账号"},{default:f((()=>[d(G,{"fast-fail":"",onSubmit:k(R,["prevent"])},{default:f((()=>[d(C,null,{default:f((()=>[d(F,{disabled:-1!==x(o).index,modelValue:x(o).item.username,"onUpdate:modelValue":i[2]||(i[2]=e=>x(o).item.username=e),label:"用户名",variant:"underlined",rules:u.username},null,8,["disabled","modelValue","rules"]),d(F,{modelValue:x(o).item.password,"onUpdate:modelValue":i[3]||(i[3]=e=>x(o).item.password=e),label:"密码",variant:"underlined",rules:u.password,type:"password"},null,8,["modelValue","rules"]),d(F,{modelValue:x(o).item.token,"onUpdate:modelValue":i[4]||(i[4]=e=>x(o).item.token=e),label:"Token",variant:"underlined"},null,8,["modelValue"]),d(P,{label:"直播",variant:"underlined",modelValue:x(B),"onUpdate:modelValue":i[5]||(i[5]=e=>y(B)?B.value=e:null)},null,8,["modelValue"]),d($,{modelValue:x(o).item.admin,"onUpdate:modelValue":i[6]||(i[6]=e=>x(o).item.admin=e),label:"管理员"},null,8,["modelValue"])])),_:1}),d(T),d(_,null,{default:f((()=>[d(O),d(S,{text:"关闭",variant:"plain",onClick:i[7]||(i[7]=e=>z.value=!1)}),d(S,{type:"submit",color:"primary",text:"保存",variant:"tonal",onClick:R})])),_:1})])),_:1})])),_:1},8,["disabled","loading","title"])]})),_:1},8,["modelValue"]),d(N,{modelValue:x(A),"onUpdate:modelValue":i[10]||(i[10]=e=>y(A)?A.value=e:null),"max-width":"500px"},{default:f((()=>[d(h,{disabled:x(l),loading:x(l),"prepend-icon":"mdi-account",title:`确认删除[${x(o).item.username}]？`},{default:f((()=>[d(C,null,{default:f((()=>i[11]||(i[11]=[j(" 删除后不可恢复，请谨慎操作！ ")]))),_:1}),d(T),d(_,null,{default:f((()=>[d(O),d(S,{text:"关闭",variant:"plain",onClick:i[9]||(i[9]=e=>A.value=!1)}),d(S,{color:"warning",text:"确认",variant:"tonal",onClick:J})])),_:1})])),_:1},8,["disabled","loading","title"])])),_:1},8,["modelValue"])])),_:1}))}};export{q as default};
